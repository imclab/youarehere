function youarehere_locate(){var a=function(b){var c=$("#status");c.html("<li>"+b+"</li>"+c.html())};navigator.geolocation.getCurrentPosition(function(b){b=b.coords;var c=b.latitude,d=b.longitude;a("The sensors have placed you at or around "+c+","+d+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+c+"&lon="+d},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(b){youarehere_map_init(b);youarehere_woe_draw_shapes([b.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:12}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var b=youarehere_map();a=a.features[0];var c=a.bbox;if(c)b.fitBounds([[c[1],c[0]],[c[3],c[2]]]);else{a=a.geometry.coordinates;b.setView([a[1],a[0]],15)}}
function youarehere_map_draw_features(a){var b=null,c=youarehere_map(),d={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},j={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},h=function(e){e=e.target;e.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){e.bringToFront();g()}},f=function(e){b.resetStyle(e.target);g()};b=L.geoJson(a,{style:function(e){if(e.geometry.type!="Point")return d},pointToLayer:function(e,i){return L.circleMarker(i,
j)},onEachFeature:function(e,i){i.on({mouseover:h,mouseout:f})}});b.addTo(c);a.features[0].geometry.type=="Point"&&_points.push(b);var g=function(){for(var e=_points.length,i=0;i<e;i++)_points[i].bringToFront()};return b}function youarehere_map_latlons_to_geojson(a){for(var b=[],c=a.length,d=0;d<c;d++)b.push({type:"Feature",geometry:{type:"Point",coordinates:[a[d][1],a[d][0]]}});b={type:"FeatureCollection",features:b};if(c>1){a=youarehere_map_coords_to_bbox(a);b.bbox=a}return b}
function youarehere_map_coords_to_bbox(a,b){for(var c=a.length,d=undefined,j=undefined,h=undefined,f=undefined,g=0;g<c;g++){var e=b?a[g][1]:a[g][0],i=b?a[g][0]:a[g][0];d=d==undefined?e:Math.min(d,e);j=j==undefined?i:Math.min(j,i);h=h==undefined?e:Math.max(h,e);f=f==undefined?i:Math.max(f,i)}c=[j,d,f,h];for(g in c)c[g]=c[g].toFixed(3);return c};function youarehere_woe_draw_shapes(a){for(var b=a.length,c=0;c<b;c++){var d=a[c],j="http://woe.spum.org/id/"+d+"/shape.js";if(d==18807771)j="http://gowanusheights.info/data/gowanus-heights.json";$.ajax({url:j,dataType:"json",success:function(h){var f=undefined;if(h.type=="FeatureCollection")f=h;else{if(!h.bbox){f=h.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");h.bbox=f}f={type:"FeatureCollection",features:[h]}}try{youarehere_map_draw_features(f).bringToBack();youarehere_map_set_viewport(f)}catch(g){}},
error:function(){}})}};
