function youarehere_locate(){var a=function(d){var c=$("#status");c.html("<li>"+d+"</li>"+c.html())};navigator.geolocation.getCurrentPosition(function(d){d=d.coords;var c=d.latitude,f=d.longitude;a("The sensors have placed you at or around "+c+","+f+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+c+"&lon="+f},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(d){youarehere_map_init(d);youarehere_woe_draw_shapes([d.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:4}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var d=youarehere_map();a=a.features[0];var c=a.bbox,f=a.geometry;if(!(a.properties&&a.properties.place_type_id==12))if(f.type=="Point"){a=f.coordinates;d.setView([a[1],a[0]],12)}else if(c){a=[[c[1],c[0]],[c[3],c[2]]];d.getBounds().extend(a)}}
function youarehere_map_draw_features(a){var d=a.features[0];if(!(d.properties&&d.properties.place_type_id==12)){var c=null;d=youarehere_map();var f={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},i={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},k=function(b){var e=$("#map-feedback");e.html(b);b?e.show():e.hide()},j=function(b){b=b.target;b.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){b.bringToFront();l()}if(b.feature){b=
b.feature;if(b.properties){var e=b.properties.label;e||(e=b.properties.name);e&&k(e)}}},h=function(b){c.resetStyle(b.target);l();k(null)},m=function(b){b=b.target.feature;if(b.properties){b=b.properties;if(b.permalink)location.href=b.permalink}};c=L.geoJson(a,{style:function(b){if(b.geometry.type!="Point")return f},pointToLayer:function(b,e){return L.circleMarker(e,i)},onEachFeature:function(b,e){e.on({click:m,mouseover:j,mouseout:h})}});c.addTo(d);a.features[0].geometry.type=="Point"&&_points.push(c);
var l=function(){for(var b=_points.length,e=0;e<b;e++)_points[e].bringToFront()};return c}}function youarehere_map_latlons_to_geojson(a){for(var d=[],c=a.length,f=0;f<c;f++){var i={type:"Feature",geometry:{type:"Point",coordinates:[a[f][1],a[f][0]]}};if(a[f].length==3)i.properties=a[f][2];d.push(i)}d={type:"FeatureCollection",features:d};if(c>1){a=youarehere_map_coords_to_bbox(a);d.bbox=a}return d}
function youarehere_map_coords_to_bbox(a,d){for(var c=a.length,f=undefined,i=undefined,k=undefined,j=undefined,h=0;h<c;h++){var m=d?a[h][1]:a[h][0],l=d?a[h][0]:a[h][0];f=f==undefined?m:Math.min(f,m);i=i==undefined?l:Math.min(i,l);k=k==undefined?m:Math.max(k,m);j=j==undefined?l:Math.max(j,l)}c=[i,f,j,k];for(h in c)c[h]=c[h].toFixed(3);return c};function youarehere_woe_draw_shapes(a){for(var d=undefined,c=undefined,f=undefined,i=undefined,k=a.length,j=0;j<k;j++){var h=a[j],m="http://woe.spum.org/id/"+h+"/shape.js";if(h==18807771)m="http://gowanusheights.info/data/gowanus-heights.json";var l=function(b){var e=undefined;if(b.type=="FeatureCollection"){e=b;b=e.features[0];if(!b.bbox){var g=b.geometry.coordinates;g=g[0][0];g=youarehere_map_coords_to_bbox(g,"lonlat");b.bbox=g;e.features[0]=b}}else{if(!b.bbox){g=b.geometry.coordinates;g=g[0][0];
g=youarehere_map_coords_to_bbox(g,"lonlat");b.bbox=g}e={type:"FeatureCollection",features:[b]}}if(e.features[0].bbox){g=e.features[0].bbox;for(var n in g)g[n]=parseFloat(g[n]);d=d==undefined?g[1]:Math.min(d,g[1]);c=c==undefined?g[0]:Math.min(c,g[0]);f=f==undefined?g[3]:Math.max(f,g[3]);i=i==undefined?g[2]:Math.max(i,g[2])}try{youarehere_map_draw_features(e).bringToBack();youarehere_map_set_viewport(e)}catch(o){}(e=e.features[0].properties)&&$("#woeid-"+e.woe_id).html(e.label+" ( "+e.woe_id+" )")};
h=l;if(j+1==k)h=function(b){l(b);b=[[d,c],[f,i]];youarehere_map().fitBounds(b)};$.ajax({url:m,dataType:"json",success:h,error:function(){}})}};
