function youarehere_locate(){var a=function(c){var b=$("#status");b.html("<li>"+c+"</li>"+b.html())};navigator.geolocation.getCurrentPosition(function(c){c=c.coords;var b=c.latitude,d=c.longitude;a("The sensors have placed you at or around "+b+","+d+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+b+"&lon="+d},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(c){youarehere_map_init(c);youarehere_woe_draw_shapes([c.features[0].properties.woe_id])}})};var _map=null;function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:12}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var c=youarehere_map();a=a.features[0];var b=a.bbox;if(b){a=[[b[1],b[0]],[b[3],b[2]]];console.log(a);c.fitBounds(a)}else{a=a.geometry.coordinates;c.setView([a[1],a[0]],15)}}
function youarehere_map_draw_features(a){var c=youarehere_map(),b={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},d={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8};a=L.geoJson(a,{style:function(g){if(g.geometry.type!="Point")return b},pointToLayer:function(g,e){return L.circleMarker(e,d)},onEachFeature:function(g,e){e.on("click",function(){})}});a.addTo(c);return a}
function youarehere_map_latlons_to_geojson(a){for(var c=[],b=a.length,d=0;d<b;d++)c.push({type:"Feature",geometry:{type:"Point",coordinates:[a[d][1],a[d][0]]}});c={type:"FeatureCollection",features:c};if(b>1){a=youarehere_map_coords_to_bbox(a);c.bbox=a}return c}
function youarehere_map_coords_to_bbox(a,c){for(var b=a.length,d=undefined,g=undefined,e=undefined,f=undefined,h=0;h<b;h++){var i=c?a[h][1]:a[h][0],j=c?a[h][0]:a[h][0];d=d==undefined?i:Math.min(d,i);g=g==undefined?j:Math.min(g,j);e=e==undefined?i:Math.max(e,i);f=f==undefined?j:Math.max(f,j)}b=[g,d,f,e];for(h in b)b[h]=b[h].toFixed(3);return b};function youarehere_woe_draw_shapes(a){for(var c=a.length,b=0;b<c;b++){var d=a[b],g="http://woe.spum.org/id/"+d+"/shape.js";if(d==18807771)g="http://gowanusheights.info/data/gowanus-heights.json";$.ajax({url:g,dataType:"json",success:function(e){var f=undefined;if(e.type=="FeatureCollection")f=e;else{if(!e.bbox){f=e.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");e.bbox=f}f={type:"FeatureCollection",features:[e]}}try{youarehere_map_draw_features(f).bringToBack();youarehere_map_set_viewport(f)}catch(h){}},
error:function(){}})}};
