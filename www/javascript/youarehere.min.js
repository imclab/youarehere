function youarehere_locate(){var a=function(c){var d=$("#status");d.html("<li>"+c+"</li>"+d.html())};navigator.geolocation.getCurrentPosition(function(c){c=c.coords;var d=c.latitude,g=c.longitude;a("The sensors have placed you at or around "+d+","+g+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+d+"&lon="+g},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(c){youarehere_map_init(c);youarehere_woe_draw_shapes([c.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:12}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var c=youarehere_map(),d=a.features[0];a=d.bbox;d=d.geometry;if(d.type=="Point"){a=d.coordinates;c.setView([a[1],a[0]],12)}else a&&c.fitBounds([[a[1],a[0]],[a[3],a[2]]])}
function youarehere_map_draw_features(a){var c=null,d=youarehere_map(),g={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},j={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},l=function(b){var e=$("#map-feedback");e.html(b);b?e.show():e.hide()},i=function(b){b=b.target;b.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){b.bringToFront();k()}if(b.feature){b=b.feature;if(b.properties){var e=b.properties.label;e||(e=b.properties.name);
e&&l(e)}}},h=function(b){c.resetStyle(b.target);k();l(null)};c=L.geoJson(a,{style:function(b){if(b.geometry.type!="Point")return g},pointToLayer:function(b,e){return L.circleMarker(e,j)},onEachFeature:function(b,e){e.on({mouseover:i,mouseout:h})}});c.addTo(d);a.features[0].geometry.type=="Point"&&_points.push(c);var k=function(){for(var b=_points.length,e=0;e<b;e++)_points[e].bringToFront()};return c}
function youarehere_map_latlons_to_geojson(a){for(var c=[],d=a.length,g=0;g<d;g++)c.push({type:"Feature",geometry:{type:"Point",coordinates:[a[g][1],a[g][0]]}});c={type:"FeatureCollection",features:c};if(d>1){a=youarehere_map_coords_to_bbox(a);c.bbox=a}return c}
function youarehere_map_coords_to_bbox(a,c){for(var d=a.length,g=undefined,j=undefined,l=undefined,i=undefined,h=0;h<d;h++){var k=c?a[h][1]:a[h][0],b=c?a[h][0]:a[h][0];g=g==undefined?k:Math.min(g,k);j=j==undefined?b:Math.min(j,b);l=l==undefined?k:Math.max(l,k);i=i==undefined?b:Math.max(i,b)}d=[j,g,i,l];for(h in d)d[h]=d[h].toFixed(3);return d};function youarehere_woe_draw_shapes(a){for(var c=undefined,d=undefined,g=undefined,j=undefined,l=a.length,i=0;i<l;i++){var h=a[i],k="http://woe.spum.org/id/"+h+"/shape.js";if(h==18807771)k="http://gowanusheights.info/data/gowanus-heights.json";$.ajax({url:k,dataType:"json",success:function(b){var e=undefined;if(b.type=="FeatureCollection"){e=b;b=e.features[0];if(!b.bbox){var f=b.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");b.bbox=f;e.features[0]=b}}else{if(!b.bbox){f=
b.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");b.bbox=f}e={type:"FeatureCollection",features:[b]}}if(e.features[0].bbox){f=e.features[0].bbox;for(i in f)f[i]=parseFloat(f[i]);c=c==undefined?f[1]:Math.min(c,f[1]);d=d==undefined?f[0]:Math.min(d,f[0]);g=g==undefined?f[3]:Math.max(g,f[3]);j=j==undefined?f[2]:Math.max(j,f[2])}try{youarehere_map_draw_features(e).bringToBack();youarehere_map_set_viewport(e)}catch(m){}},error:function(){}})}};
