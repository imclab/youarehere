function youarehere_locate(){var a=function(b){var c=$("#status");c.html("<li>"+b+"</li>"+c.html())};navigator.geolocation.getCurrentPosition(function(b){b=b.coords;var c=b.latitude,e=b.longitude;a("The sensors have placed you at or around "+c+","+e+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+c+"&lon="+e},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(b){youarehere_map_init(b);youarehere_woe_draw_shapes([b.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:12}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var b=youarehere_map();a=a.features[0];var c=a.bbox;if(c)b.fitBounds([[c[1],c[0]],[c[3],c[2]]]);else{a=a.geometry.coordinates;b.setView([a[1],a[0]],15)}}
function youarehere_map_draw_features(a){var b=null,c=youarehere_map(),e={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},j={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},h=function(d){var g=$("#map-feedback");g.html(d);d?g.show():g.hide()},f=function(d){d=d.target;d.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){d.bringToFront();k()}if(d.feature){d=d.feature;if(d.properties){var g=d.properties.label;g||(g=d.properties.name);
g&&h(g)}}},i=function(d){b.resetStyle(d.target);k();h(null)};b=L.geoJson(a,{style:function(d){if(d.geometry.type!="Point")return e},pointToLayer:function(d,g){return L.circleMarker(g,j)},onEachFeature:function(d,g){g.on({mouseover:f,mouseout:i})}});b.addTo(c);a.features[0].geometry.type=="Point"&&_points.push(b);var k=function(){for(var d=_points.length,g=0;g<d;g++)_points[g].bringToFront()};return b}
function youarehere_map_latlons_to_geojson(a){for(var b=[],c=a.length,e=0;e<c;e++)b.push({type:"Feature",geometry:{type:"Point",coordinates:[a[e][1],a[e][0]]}});b={type:"FeatureCollection",features:b};if(c>1){a=youarehere_map_coords_to_bbox(a);b.bbox=a}return b}
function youarehere_map_coords_to_bbox(a,b){for(var c=a.length,e=undefined,j=undefined,h=undefined,f=undefined,i=0;i<c;i++){var k=b?a[i][1]:a[i][0],d=b?a[i][0]:a[i][0];e=e==undefined?k:Math.min(e,k);j=j==undefined?d:Math.min(j,d);h=h==undefined?k:Math.max(h,k);f=f==undefined?d:Math.max(f,d)}c=[j,e,f,h];for(i in c)c[i]=c[i].toFixed(3);return c};function youarehere_woe_draw_shapes(a){for(var b=a.length,c=0;c<b;c++){var e=a[c],j="http://woe.spum.org/id/"+e+"/shape.js";if(e==18807771)j="http://gowanusheights.info/data/gowanus-heights.json";$.ajax({url:j,dataType:"json",success:function(h){var f=undefined;if(h.type=="FeatureCollection")f=h;else{if(!h.bbox){f=h.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");h.bbox=f}f={type:"FeatureCollection",features:[h]}}try{youarehere_map_draw_features(f).bringToBack();youarehere_map_set_viewport(f)}catch(i){}},
error:function(){}})}};
