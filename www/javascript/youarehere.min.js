function youarehere_locate(){var a=function(e){var c=$("#status");c.html("<li>"+e+"</li>"+c.html())};navigator.geolocation.getCurrentPosition(function(e){e=e.coords;var c=e.latitude,f=e.longitude;a("The sensors have placed you at or around "+c+","+f+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+c+"&lon="+f},2500)},function(){});a("Asking the sky where you are.")};function youarehere_correction_draw_map(a){$.ajax({url:a,success:function(e){youarehere_map_init(e);youarehere_woe_draw_shapes([e.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:4}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var e=youarehere_map();a=a.features[0];var c=a.bbox,f=a.geometry;if(!(a.properties&&a.properties.place_type_id==12))if(f.type=="Point"){a=f.coordinates;e.setView([a[1],a[0]],12)}else if(c){a=[[c[1],c[0]],[c[3],c[2]]];e.getBounds().extend(a)}}
function youarehere_map_draw_features(a){var e=a.features[0];if(!(e.properties&&e.properties.place_type_id==12)){var c=null;e=youarehere_map();var f={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},k={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},l=function(d){var b=$("#map-feedback");b.html(d);d?b.show():b.hide()},n=function(d){d=d.target;d.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){d.bringToFront();m()}if(d.feature){d=
d.feature;if(d.properties){var b=d.properties.label;b||(b=d.properties.name);b&&l(b)}}},h=function(d){c.resetStyle(d.target);m();l(null)},j=function(d){d=d.target.feature;if(d.properties){d=d.properties;if(d.permalink)location.href=d.permalink}};c=L.geoJson(a,{style:function(d){if(d.geometry.type!="Point")return f},pointToLayer:function(d,b){return L.circleMarker(b,k)},onEachFeature:function(d,b){b.on({click:j,mouseover:n,mouseout:h})}});c.addTo(e);a.features[0].geometry.type=="Point"&&_points.push(c);
var m=function(){for(var d=_points.length,b=0;b<d;b++)_points[b].bringToFront()};return c}}function youarehere_map_latlons_to_geojson(a){for(var e=[],c=a.length,f=0;f<c;f++){var k={type:"Feature",geometry:{type:"Point",coordinates:[a[f][1],a[f][0]]}};if(a[f].length==3)k.properties=a[f][2];e.push(k)}e={type:"FeatureCollection",features:e};if(c>1){a=youarehere_map_coords_to_bbox(a);e.bbox=a}return e}
function youarehere_map_coords_to_bbox(a,e){for(var c=a.length,f=undefined,k=undefined,l=undefined,n=undefined,h=0;h<c;h++){var j=e?a[h][1]:a[h][0],m=e?a[h][0]:a[h][0];f=f==undefined?j:Math.min(f,j);k=k==undefined?m:Math.min(k,m);l=l==undefined?j:Math.max(l,j);n=n==undefined?m:Math.max(n,m)}c=[k,f,n,l];for(h in c)c[h]=c[h].toFixed(3);return c};function youarehere_woe_draw_shapes(a){for(var e=undefined,c=undefined,f=undefined,k=undefined,l=a.length,n=[],h=0;h<l;h++){var j=a[h];if(j!=-1){var m="http://woe.spum.org/id/"+j+"/shape.js";if(j==18807771)m="http://gowanusheights.info/data/gowanus-heights.json";if(!($.inArray(j,n)>=0)){n.push(j);var d=function(b){var i=undefined;if(b.type=="FeatureCollection"){i=b;b=i.features[0];if(!b.bbox){var g=b.geometry.coordinates;g=g[0][0];g=youarehere_map_coords_to_bbox(g,"lonlat");b.bbox=g;i.features[0]=
b}}else{if(!b.bbox){g=b.geometry.coordinates;g=g[0][0];g=youarehere_map_coords_to_bbox(g,"lonlat");b.bbox=g}i={type:"FeatureCollection",features:[b]}}if(i.features[0].bbox){g=i.features[0].bbox;for(var o in g)g[o]=parseFloat(g[o]);e=e==undefined?g[1]:Math.min(e,g[1]);c=c==undefined?g[0]:Math.min(c,g[0]);f=f==undefined?g[3]:Math.max(f,g[3]);k=k==undefined?g[2]:Math.max(k,g[2])}try{youarehere_map_draw_features(i).bringToBack();youarehere_map_set_viewport(i)}catch(p){}if(i=i.features[0].properties){o=
i.woe_id;b=i.label;if(i.id)o=i.id;if(i.name)b=i.name;$(".woeid-"+o).html(b+" ( "+o+" )")}};j=d;if(h+1==l)j=function(b){d(b);b=[[e,c],[f,k]];youarehere_map().fitBounds(b)};$.ajax({url:m,dataType:"json",success:j,error:function(){}})}}}};
